"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[31463],{31463:(e,t,a)=>{a.d(t,{connectSmartAccount:()=>ex,disconnectSmartAccount:()=>eV});var r=a(55389),n=a(23802),i=a(2579),s=a(59373),o=a(91764),c=a(58528),d=a(49386),m=a(19131),p=a(74340);let y=[{type:"address",name:"signer"}],l=[{type:"tuple",name:"permissions",components:[{type:"address",name:"signer"},{type:"address[]",name:"approvedTargets"},{type:"uint256",name:"nativeTokenLimitPerTransaction"},{type:"uint128",name:"startTimestamp"},{type:"uint128",name:"endTimestamp"}]}];async function u(e){return(0,p.readContract)({contract:e.contract,method:["0xf15d424e",y,l],params:[e.signer]})}var f=a(3702),v=a(66971);let w=[{type:"tuple",name:"req",components:[{type:"address",name:"signer"},{type:"uint8",name:"isAdmin"},{type:"address[]",name:"approvedTargets"},{type:"uint256",name:"nativeTokenLimitPerTransaction"},{type:"uint128",name:"permissionStartTimestamp"},{type:"uint128",name:"permissionEndTimestamp"},{type:"uint128",name:"reqValidityStartTimestamp"},{type:"uint128",name:"reqValidityEndTimestamp"},{type:"bytes32",name:"uid"}]},{type:"bytes",name:"signature"}],h=[];var G=a(40651);function g(){return new Date(Date.now()+31536e7)}function A(e){return(0,G.Dg)(Math.floor(e.getTime()/1e3))}var L=a(25955);let P=[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}];async function T(e){let{account:t,contract:a,req:r}=e,n=await t.signTypedData({domain:{name:"Account",version:"1",verifyingContract:a.address,chainId:a.chain.id},primaryType:"SignerPermissionRequest",types:{SignerPermissionRequest:P},message:r});return{req:r,signature:n}}async function x(e){let{target:t,permissions:a}=e;return{approvedTargets:"*"===a.approvedTargets?[c.cF]:a.approvedTargets,nativeTokenLimitPerTransaction:(0,m.fq)(a.nativeTokenLimitPerTransaction?.toString()||"0"),permissionStartTimestamp:A(a.permissionStartTimestamp||new Date(0)),permissionEndTimestamp:A(a.permissionEndTimestamp||g()),reqValidityStartTimestamp:0n,reqValidityEndTimestamp:A(g()),uid:await (0,L.O)(),isAdmin:0,signer:t}}async function V(e){var t,a;let{accountContract:r,sessionKeyAddress:n,newPermissions:i}=e;if(!await (0,d.isContractDeployed)(r))return!0;let s=await u({contract:r,signer:n});return!!(s.endTimestamp&&s.endTimestamp<Math.floor(new Date().getTime()/1e3)||(t=s.approvedTargets,!("*"===(a=i.approvedTargets)&&1===t.length&&t[0]===c.cF||"*"!==a&&a.map(e=>e.toLowerCase()).every(e=>t.map(e=>e.toLowerCase()).includes(e))))||(0,m.fq)(i.nativeTokenLimitPerTransaction?.toString()??"0")>s.nativeTokenLimitPerTransaction)}var O=a(23316),D=a(81647),b=a(99134),C=a(99232),k=a(67316),I=a(94),F=a(94879);let S=2n**96n-1n;var E=a(40633),q=a(54500),$=a(14408),B=a(40310),M=a(48624);let U=[{type:"address",name:"sender"},{type:"uint192",name:"key"}],H=[{type:"uint256",name:"nonce"}];async function z(e){return(0,p.readContract)({contract:e.contract,method:["0x35567e1a",U,H],params:[e.sender,e.key]})}let j=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"uint256",name:"callGasLimit"},{type:"uint256",name:"verificationGasLimit"},{type:"uint256",name:"preVerificationGas"},{type:"uint256",name:"maxFeePerGas"},{type:"uint256",name:"maxPriorityFeePerGas"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],W=[{type:"bytes32"}];async function K(e){return(0,p.readContract)({contract:e.contract,method:["0xa6193531",j,W],params:[e.userOp]})}let R=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"bytes32",name:"accountGasLimits"},{type:"uint256",name:"preVerificationGas"},{type:"bytes32",name:"gasFees"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],N=[{type:"bytes32"}];async function _(e){return(0,p.readContract)({contract:e.contract,method:["0x22cdde4c",R,N],params:[e.userOp]})}var Q=a(66043),Y=a(8121),J=a(33267),Z=a(23471),X=a(95821),ee=a(98864),et=a(43324),ea=a(8118),er=a(15693),en=a(99443);let ei=e=>({sender:e.sender,nonce:BigInt(e.nonce),initCode:function(e){return e.factory?(0,M.xW)([e.factory,e.factoryData||"0x"]):"0x"}(e),callData:e.callData,accountGasLimits:function(e){return(0,M.xW)([(0,er.eV)((0,en.nj)(BigInt(e.verificationGasLimit)),{size:16}),(0,er.eV)((0,en.nj)(BigInt(e.callGasLimit)),{size:16})])}(e),preVerificationGas:BigInt(e.preVerificationGas),gasFees:function(e){return(0,M.xW)([(0,er.eV)((0,en.nj)(BigInt(e.maxPriorityFeePerGas)),{size:16}),(0,er.eV)((0,en.nj)(BigInt(e.maxFeePerGas)),{size:16})])}(e),paymasterAndData:function(e){return e.paymaster?(0,M.xW)([e.paymaster,(0,er.eV)((0,en.nj)(BigInt(e.paymasterVerificationGasLimit||0)),{size:16}),(0,er.eV)((0,en.nj)(BigInt(e.paymasterPostOpGasLimit||0)),{size:16}),e.paymasterData||"0x"]):"0x"}(e),signature:e.signature});var es=a(72556);async function eo(e){let{userOp:t,paymasterOverride:a,client:r,chain:n,entrypointAddress:i}=e;if(a)return a(t);let s=i??$.uh,o=(0,$.RZ)(n),c={jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[(0,es.K)(t),s]},d=(0,ee.getClientFetch)(r),m=await d(o,{method:"POST",headers:{"Content-Type":"application/json"},body:(0,ea.stringify)(c)});if(!m.ok){let e=await m.text()||m.statusText;throw Error(`Paymaster error: ${m.status} - ${e}`)}let p=await m.json();if(p.result)return"string"==typeof p.result?{paymasterAndData:p.result}:(p.result.reason&&console.warn(`Paymaster policy rejected this transaction with reason: ${p.result.reason} ${p.result.policyId?`(policyId: ${p.result.policyId})`:""}`),{paymasterAndData:p.result.paymasterAndData,verificationGasLimit:p.result.verificationGasLimit?(0,Z.uU)(p.result.verificationGasLimit):void 0,preVerificationGas:p.result.preVerificationGas?(0,Z.uU)(p.result.preVerificationGas):void 0,callGasLimit:p.result.callGasLimit?(0,Z.uU)(p.result.callGasLimit):void 0,paymaster:p.result.paymaster,paymasterData:p.result.paymasterData,paymasterVerificationGasLimit:p.result.paymasterVerificationGasLimit?(0,Z.uU)(p.result.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:p.result.paymasterPostOpGasLimit?(0,Z.uU)(p.result.paymasterPostOpGasLimit):void 0});let y=p.error?.message||p.error||m.statusText||"unknown error";throw Error(`Paymaster error from ${o}: ${y}`)}let ec=new Set,ed=e=>`${e.chain.id}:${e.address}`,em=e=>{ec.add(ed(e))},ep=e=>{ec.delete(ed(e))},ey=e=>ec.has(ed(e));async function el(e){let t=e.timeoutMs||12e4,a=e.intervalMs||1e3,r=Date.now()+t;for(;Date.now()<r;){let t=await (0,E.JI)(e);if(t)return t;await new Promise(e=>setTimeout(e,a))}throw Error(`Timeout waiting for userOp to be mined on chain ${e.chain.id} with UserOp hash: ${e.userOpHash}`)}async function eu(e){let{transaction:t,accountContract:a,factoryContract:r,adminAddress:n,overrides:i,sponsorGas:s,waitForDeployment:o=!0,isDeployedOverride:c}=e,m=t.chain,p=t.client,y={client:p,chain:m,bundlerUrl:i?.bundlerUrl,entrypointAddress:i?.entrypointAddress},l=(0,$.Fn)(e.overrides?.entrypointAddress||$.uh),[u,f,v,w,h]=await Promise.all(["boolean"==typeof c?c:(0,d.isContractDeployed)(a).then(e=>e||ey(a)),(0,Y.encode)(t),(0,I.r)(t.gas),ef({executeTx:t,bundlerOptions:y,chain:m,client:p}),eA({accountContract:a,chain:m,client:p,entrypointAddress:i?.entrypointAddress,getNonceOverride:i?.getAccountNonce})]),{maxFeePerGas:G,maxPriorityFeePerGas:g}=w;return"v0.7"===l?ev({bundlerOptions:y,factoryContract:r,accountContract:a,adminAddress:n,sponsorGas:s,overrides:i,isDeployed:u,nonce:h,callData:f,callGasLimit:v,maxFeePerGas:G,maxPriorityFeePerGas:g,waitForDeployment:o}):ew({bundlerOptions:y,factoryContract:r,accountContract:a,adminAddress:n,sponsorGas:s,overrides:i,isDeployed:u,nonce:h,callData:f,callGasLimit:v,maxFeePerGas:G,maxPriorityFeePerGas:g,waitForDeployment:o})}async function ef(e){let{executeTx:t,bundlerOptions:a,chain:r,client:n}=e,{maxFeePerGas:i,maxPriorityFeePerGas:s}=t,o=a?.bundlerUrl??(0,$.RZ)(r);if((0,ee.isThirdwebUrl)(o)){let e=await (0,E.fB)({options:a});i=e.maxFeePerGas,s=e.maxPriorityFeePerGas}else{let[e,t]=await Promise.all([(0,I.r)(i),(0,I.r)(s)]);if(e&&t)i=e,s=t;else{let a=await (0,Q.G)(n,r);s=t??a.maxPriorityFeePerGas??0n,i=e??a.maxFeePerGas??0n}}return{maxFeePerGas:i,maxPriorityFeePerGas:s}}async function ev(e){let t,a,{bundlerOptions:r,isDeployed:n,factoryContract:i,accountContract:s,adminAddress:o,sponsorGas:c,overrides:d,nonce:m,callData:p,callGasLimit:y,maxFeePerGas:l,maxPriorityFeePerGas:u,waitForDeployment:f}=e,{chain:v,client:w}=r;n?(a="0x",f&&await eL(s)):(t=i.address,a=await (0,Y.encode)((0,q.HM)({factoryContract:i,adminAddress:o,accountSalt:d?.accountSalt,createAccountOverride:d?.createAccount})),f&&em(s));let h={sender:s.address,nonce:m,callData:p,maxFeePerGas:l,maxPriorityFeePerGas:u,callGasLimit:y??0n,verificationGasLimit:0n,preVerificationGas:0n,factory:t,factoryData:a,paymaster:void 0,paymasterData:"0x",paymasterVerificationGasLimit:0n,paymasterPostOpGasLimit:0n,signature:$.km};if(c){let e=await eo({userOp:h,chain:v,client:w,entrypointAddress:d?.entrypointAddress,paymasterOverride:d?.paymaster});if(e.paymaster&&e.paymasterData&&(h.paymaster=e.paymaster,h.paymasterData=e.paymasterData),e.callGasLimit&&e.verificationGasLimit&&e.preVerificationGas&&e.paymasterPostOpGasLimit&&e.paymasterVerificationGasLimit)h.callGasLimit=e.callGasLimit,h.verificationGasLimit=e.verificationGasLimit,h.preVerificationGas=e.preVerificationGas,h.paymasterPostOpGasLimit=e.paymasterPostOpGasLimit,h.paymasterVerificationGasLimit=e.paymasterVerificationGasLimit;else{let e=d?.tokenPaymaster?{[d.tokenPaymaster.tokenAddress]:{stateDiff:{[(0,et.S)((0,J.hd)([{type:"address"},{type:"uint256"}],[s.address,d.tokenPaymaster.balanceStorageSlot]))]:(0,Z.nj)(B.EA,{size:32})}}}:void 0,t=await (0,E.yY)({userOp:h,options:r},e);h.callGasLimit=t.callGasLimit,h.verificationGasLimit=t.verificationGasLimit,h.preVerificationGas=t.preVerificationGas,h.paymasterPostOpGasLimit=d?.tokenPaymaster?500000n:t.paymasterPostOpGasLimit||0n,h.paymasterVerificationGasLimit=t.paymasterVerificationGasLimit||0n;let a=await eo({userOp:h,chain:v,client:w,entrypointAddress:d?.entrypointAddress,paymasterOverride:d?.paymaster});a.paymaster&&a.paymasterData&&(h.paymaster=a.paymaster,h.paymasterData=a.paymasterData)}}else{let e=await (0,E.yY)({userOp:h,options:r});h.callGasLimit=e.callGasLimit,h.verificationGasLimit=e.verificationGasLimit,h.preVerificationGas=e.preVerificationGas,h.paymasterPostOpGasLimit=e.paymasterPostOpGasLimit||0n,h.paymasterVerificationGasLimit=e.paymasterVerificationGasLimit||0n}return{...h,signature:"0x"}}async function ew(e){let t,{bundlerOptions:a,isDeployed:r,factoryContract:n,accountContract:i,adminAddress:s,sponsorGas:o,overrides:c,nonce:d,callData:m,callGasLimit:p,maxFeePerGas:y,maxPriorityFeePerGas:l,waitForDeployment:u}=e,{chain:f,client:v}=a;r?(t="0x",u&&await eL(i)):(t=await eg({factoryContract:n,adminAddress:s,accountSalt:c?.accountSalt,createAccountOverride:c?.createAccount}),u&&em(i));let w={sender:i.address,nonce:d,initCode:t,callData:m,maxFeePerGas:y,maxPriorityFeePerGas:l,callGasLimit:p??0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:$.km};if(o){let e=await eo({userOp:w,chain:f,client:v,entrypointAddress:c?.entrypointAddress,paymasterOverride:c?.paymaster}),t="paymasterAndData"in e?e.paymasterAndData:"0x";if(t&&"0x"!==t&&(w.paymasterAndData=t),e.callGasLimit&&e.verificationGasLimit&&e.preVerificationGas)w.callGasLimit=e.callGasLimit,w.verificationGasLimit=e.verificationGasLimit,w.preVerificationGas=e.preVerificationGas;else{let e=await (0,E.yY)({userOp:w,options:a});if(w.callGasLimit=e.callGasLimit,w.verificationGasLimit=e.verificationGasLimit,w.preVerificationGas=e.preVerificationGas,t&&"0x"!==t){let e=await eo({userOp:w,chain:f,client:v,entrypointAddress:c?.entrypointAddress,paymasterOverride:c?.paymaster}),t="paymasterAndData"in e?e.paymasterAndData:"0x";t&&"0x"!==t&&(w.paymasterAndData=t)}}}else{let e=await (0,E.yY)({userOp:w,options:a});w.callGasLimit=e.callGasLimit,w.verificationGasLimit=e.verificationGasLimit,w.preVerificationGas=e.preVerificationGas}return{...w,signature:"0x"}}async function eh(e){let{userOp:t,chain:a,entrypointAddress:r,adminAccount:n}=e,i=await eG({client:e.client,userOp:t,chain:a,entrypointAddress:r});if(n.signMessage){let e=await n.signMessage({message:{raw:(0,X.aT)(i)},originalMessage:(0,ea.stringify)(t),chainId:a.id});return{...t,signature:e}}throw Error("signMessage not implemented in signingAccount")}async function eG(e){let t,{userOp:a,chain:r,entrypointAddress:n}=e;if("v0.7"===(0,$.Fn)(n||$.uh)){let s=ei(a);t=await _({contract:(0,i.P)({address:n||$.nF,chain:r,client:e.client}),userOp:s})}else t=await K({contract:(0,i.P)({address:n||$.uh,chain:r,client:e.client}),userOp:a});return t}async function eg(e){let{factoryContract:t,adminAddress:a,accountSalt:r,createAccountOverride:n}=e,i=(0,q.HM)({factoryContract:t,adminAddress:a,accountSalt:r,createAccountOverride:n});return(0,M.xW)([t.address,await (0,Y.encode)(i)])}async function eA(e){let{accountContract:t,chain:a,client:r,entrypointAddress:n,getNonceOverride:s}=e;return s?s(t):await z({contract:(0,i.P)({address:n||$.uh,chain:a,client:r}),key:(0,es.t)(),sender:t.address})}async function eL(e){let t=Date.now();for(;ey(e);){if(Date.now()-t>6e4)throw ep(e),Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(e=>setTimeout(e,500))}}let eP=new WeakMap,eT=new WeakMap;async function ex(e,t){let{personalAccount:a,client:s,chain:o}=e;if(!a)throw Error("No personal account provided for smart account connection");let c=o??t.chain,d="gasless"in t?t.gasless:t.sponsorGas;if(await (0,k.k)(c))return[function(e){let{creationOptions:t,connectionOptions:a,chain:i}=e,s={address:(0,C.bv)(a.personalAccount.address),async sendTransaction(o){let c={data:o.data,to:o.to??void 0,value:o.value??0n,chain:(0,n.Q4)(o.chainId),client:a.client,eip712:o.eip712},d=await (0,b.f)({account:s,transaction:c});if(e.sponsorGas&&!d.paymaster){let e=await (0,E.qq)({options:{client:a.client,chain:i,bundlerUrl:t.overrides?.bundlerUrl,entrypointAddress:t.overrides?.entrypointAddress},transaction:d});d={...d,...e}}let m=await (0,b.a)({account:s,chainId:i.id,eip712Transaction:d}),p=await (0,E.vx)({options:{client:a.client,chain:i,bundlerUrl:t.overrides?.bundlerUrl,entrypointAddress:t.overrides?.entrypointAddress},transaction:d,signedTransaction:m});return(0,r.E)({client:a.client,chainId:i.id,transactionHash:p.transactionHash,walletAddress:s.address,walletType:"smart",contractAddress:o.to??void 0}),{transactionHash:p.transactionHash,client:a.client,chain:i}},signMessage:async({message:e})=>a.personalAccount.signMessage({message:e}),async signTypedData(e){let t=(0,F.y)(e);return a.personalAccount.signTypedData(t)},onTransactionRequested:async e=>a.personalAccount.onTransactionRequested?.(e)};return s}({creationOptions:t,connectionOptions:e,chain:c,sponsorGas:d}),c];if(t.factoryAddress&&!t.overrides?.entrypointAddress){let e=await eC(t.factoryAddress,s,c);e&&(t.overrides={...t.overrides,entrypointAddress:e})}t.overrides?.tokenPaymaster&&!t.overrides?.entrypointAddress&&(t.overrides={...t.overrides,entrypointAddress:$.nF});let m=t.factoryAddress??(0,$.Fd)(t.overrides?.entrypointAddress),p=(0,i.P)({client:s,address:m,chain:c}),y=await (0,q.Mi)({factoryContract:p,adminAddress:a.address,predictAddressOverride:t.overrides?.predictAddress,accountSalt:t.overrides?.accountSalt,accountAddress:t.overrides?.accountAddress}).then(e=>e).catch(e=>{throw Error(`Failed to get account address with factory contract ${p.address} on chain ID ${c.id}: ${e?.message||"unknown error"}`,{cause:e})}),l=(0,i.P)({client:s,address:y,chain:c}),u=await eO({...t,chain:c,sponsorGas:d,personalAccount:a,accountContract:l,factoryContract:p,client:s});if(eP.set(a,u),eT.set(u,a),t.sessionKey&&await V({accountContract:l,sessionKeyAddress:t.sessionKey.address,newPermissions:t.sessionKey.permissions})){let e=function(e){let{contract:t,sessionKeyAddress:a,account:r,permissions:n}=e;var i={contract:t,async asyncParams(){let{req:e,signature:i}=await T({account:r,contract:t,req:await x({target:a,permissions:n})});return{signature:i,req:e}}};let s=(0,v.O)(async()=>"asyncParams"in i?await i.asyncParams():i);return(0,f.m)({contract:i.contract,method:["0x5892e236",w,h],params:async()=>{let e=await s();return[e.req,e.signature]},value:async()=>(await s()).overrides?.value,accessList:async()=>(await s()).overrides?.accessList,gas:async()=>(await s()).overrides?.gas,gasPrice:async()=>(await s()).overrides?.gasPrice,maxFeePerGas:async()=>(await s()).overrides?.maxFeePerGas,maxPriorityFeePerGas:async()=>(await s()).overrides?.maxPriorityFeePerGas,nonce:async()=>(await s()).overrides?.nonce,extraGas:async()=>(await s()).overrides?.extraGas,erc20Value:async()=>(await s()).overrides?.erc20Value,authorizationList:async()=>(await s()).overrides?.authorizationList})}({account:a,contract:l,permissions:t.sessionKey.permissions,sessionKeyAddress:t.sessionKey.address});await (0,O.sendTransaction)({account:u,transaction:e})}return[u,c]}async function eV(e){let t=eT.get(e);t&&(eP.delete(t),eT.delete(e))}async function eO(e){let t=e.overrides?.tokenPaymaster;if(t&&"v0.7"!==(0,$.Fn)(e.overrides?.entrypointAddress||$.uh))throw Error("Token paymaster is only supported for entrypoint version v0.7");let s=e.accountContract,o={address:(0,C.bv)(s.address),async sendTransaction(a){let c;if(t){await eD({accountContract:s,erc20Paymaster:t,options:e});let a=async()=>({paymaster:t.paymasterAddress,paymasterData:"0x"});c=e.overrides?.paymaster||a}else c=e.overrides?.paymaster;a.chainId!==s.chain.id&&(s=(0,i.P)({address:o.address,chain:(0,n.Q4)(a.chainId),client:e.client}));let d=(0,q.Lc)({accountContract:s,transaction:a,executeOverride:e.overrides?.execute}),m=(0,n.Q4)(a.chainId),p=await eb({executeTx:d,options:{...e,chain:m,accountContract:s,overrides:{...e.overrides,paymaster:c}}});return(0,r.E)({client:e.client,chainId:m.id,transactionHash:p.transactionHash,walletAddress:e.accountContract.address,walletType:"smart",contractAddress:a.to??void 0}),p},async sendBatchTransaction(t){let a=(0,q.zi)({accountContract:s,transactions:t,executeBatchOverride:e.overrides?.executeBatch});if(0===t.length)throw Error("No transactions to send");let i=t[0];if(!i)throw Error("No transactions to send");let o=(0,n.Q4)(i.chainId),c=await eb({executeTx:a,options:{...e,chain:o,accountContract:s}});return(0,r.E)({client:e.client,chainId:o.id,transactionHash:c.transactionHash,walletAddress:e.accountContract.address,walletType:"smart",contractAddress:t[0]?.to??void 0}),c},async signMessage({message:t}){if(e.overrides?.signMessage)return e.overrides.signMessage({adminAccount:e.personalAccount,factoryContract:e.factoryContract,accountContract:s,message:t});let{smartAccountSignMessage:r}=await Promise.all([a.e(95025),a.e(51879),a.e(98503),a.e(72412)]).then(a.bind(a,72412));return r({accountContract:s,factoryContract:e.factoryContract,options:e,message:t})},async signTypedData(t){if(e.overrides?.signTypedData)return e.overrides.signTypedData({adminAccount:e.personalAccount,factoryContract:e.factoryContract,accountContract:s,typedData:t});let{smartAccountSignTypedData:r}=await Promise.all([a.e(95025),a.e(51879),a.e(98503),a.e(72412)]).then(a.bind(a,72412));return r({accountContract:s,factoryContract:e.factoryContract,options:e,typedData:t})},onTransactionRequested:async t=>e.personalAccount.onTransactionRequested?.(t)};return o}async function eD(e){let{accountContract:t,erc20Paymaster:a,options:r}=e,n=a.tokenAddress,c=(0,i.P)({address:n,chain:t.chain,client:t.client});if(await (0,s.nB)({contract:c,owner:t.address,spender:a.paymasterAddress})>0n)return;let d=(0,o.S)({contract:c,spender:a.paymasterAddress,amountWei:S-1n}),m=await (0,D.$)({transaction:d,from:t.address}),p=(0,q.Lc)({accountContract:t,transaction:m,executeOverride:r.overrides?.execute});await eb({executeTx:p,options:{...r,overrides:{...r.overrides,tokenPaymaster:void 0}}})}async function eb(e){let{executeTx:t,options:a}=e;try{let e=await eu({transaction:t,factoryContract:a.factoryContract,accountContract:a.accountContract,adminAddress:a.personalAccount.address,sponsorGas:a.sponsorGas,overrides:a.overrides}),n=await eh({client:a.client,chain:a.chain,adminAccount:a.personalAccount,entrypointAddress:a.overrides?.entrypointAddress,userOp:e}),i={chain:a.chain,client:a.client,bundlerUrl:a.overrides?.bundlerUrl,entrypointAddress:a.overrides?.entrypointAddress},s=await (0,E.Ro)({options:i,userOp:n}),o=await el({...i,userOpHash:s});return(0,r.E)({client:a.client,chainId:a.chain.id,transactionHash:o.transactionHash,walletAddress:a.accountContract.address,walletType:"smart",contractAddress:await (0,I.r)(t.to??void 0)}),{client:a.client,chain:a.chain,transactionHash:o.transactionHash}}finally{ep(a.accountContract)}}async function eC(e,t,a){let r=(0,i.P)({address:e,client:t,chain:a});try{return await (0,p.readContract)({contract:r,method:"function entrypoint() public view returns (address)"})}catch{return}}},54500:(e,t,a)=>{a.d(t,{HM:()=>d,Lc:()=>m,Mi:()=>c,zi:()=>p});var r=a(3702),n=a(74340),i=a(53360),s=a(23471),o=a(72980);async function c(e){let{factoryContract:t,predictAddressOverride:a,adminAddress:r,accountSalt:c,accountAddress:d}=e;if(a)return a(t,r);if(d)return d;if(!r)throw Error("Account address is required to predict the smart wallet address.");return(0,o.n)(async()=>{let e,a=c&&(0,i.q)(c)?c:(0,s.i3)(c??""),o=0;for(;o<=3;)try{e=await (0,n.readContract)({contract:t,method:"function getAddress(address, bytes) returns (address)",params:[r,a]});break}catch(t){if(3===o)throw t;let e=2**(o+1)*200;await new Promise(t=>setTimeout(t,e)),o++}if(!e)throw Error(`No smart account address found for admin address ${r} and salt ${c}`);return e},{cacheKey:`${e.factoryContract.chain.id}-${e.factoryContract.address}-${e.adminAddress}-${e.accountSalt}`,cacheTime:864e5})}function d(e){let{adminAddress:t,factoryContract:a,createAccountOverride:n,accountSalt:o}=e;if(n)return n(a,t);let c=o&&(0,i.q)(o)?o:(0,s.i3)(o??"");return(0,r.m)({contract:a,method:"function createAccount(address, bytes) returns (address)",params:[t,c]})}function m(e){let{accountContract:t,transaction:a,executeOverride:n}=e;if(n)return n(t,a);let i=a.value||0n;return(295===a.chainId||296===a.chainId)&&(i=BigInt(i)/BigInt(1e10)),(0,r.m)({contract:t,method:"function execute(address, uint256, bytes)",params:[a.to||"",i,a.data||"0x"],gas:a.gas?a.gas+21000n:void 0})}function p(e){let{accountContract:t,transactions:a,executeBatchOverride:n}=e;if(n)return n(t,a);let i=a.map(e=>e.value||0n),s=a[0]?.chainId;return(295===s||296===s)&&(i=i.map(e=>BigInt(e)/BigInt(1e10))),(0,r.m)({contract:t,method:"function executeBatch(address[], uint256[], bytes[])",params:[a.map(e=>e.to||""),i,a.map(e=>e.data||"0x")]})}},59373:(e,t,a)=>{a.d(t,{nB:()=>s});var r=a(74340);let n=[{type:"address",name:"owner"},{type:"address",name:"spender"}],i=[{type:"uint256"}];async function s(e){return(0,r.readContract)({contract:e.contract,method:["0xdd62ed3e",n,i],params:[e.owner,e.spender]})}},91764:(e,t,a)=>{a.d(t,{S:()=>c});var r=a(19131),n=a(3702),i=a(66971);let s=[{type:"address",name:"spender"},{type:"uint256",name:"value"}],o=[{type:"bool"}];function c(e){var t={contract:e.contract,asyncParams:async()=>{let t;if("amount"in e){let{decimals:n}=await a.e(18872).then(a.bind(a,18872)),i=await n(e).catch(()=>18);t=(0,r.J1)(e.amount.toString(),i)}else t=e.amountWei;return{spender:e.spender,value:t,overrides:{erc20Value:{amountWei:t,tokenAddress:e.contract.address}}}}};let c=(0,i.O)(async()=>"asyncParams"in t?await t.asyncParams():t);return(0,n.m)({contract:t.contract,method:["0x095ea7b3",s,o],params:async()=>{let e=await c();return[e.spender,e.value]},value:async()=>(await c()).overrides?.value,accessList:async()=>(await c()).overrides?.accessList,gas:async()=>(await c()).overrides?.gas,gasPrice:async()=>(await c()).overrides?.gasPrice,maxFeePerGas:async()=>(await c()).overrides?.maxFeePerGas,maxPriorityFeePerGas:async()=>(await c()).overrides?.maxPriorityFeePerGas,nonce:async()=>(await c()).overrides?.nonce,extraGas:async()=>(await c()).overrides?.extraGas,erc20Value:async()=>(await c()).overrides?.erc20Value,authorizationList:async()=>(await c()).overrides?.authorizationList})}}}]);